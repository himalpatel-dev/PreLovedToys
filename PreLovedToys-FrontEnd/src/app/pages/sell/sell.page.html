<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    <ion-title>Sell Toy</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">

  <div class="image-upload-box" (click)="fileInput.click()">
    <img *ngIf="previewImage" [src]="previewImage" />
    <div *ngIf="!previewImage" class="placeholder">
      <ion-icon name="camera-outline"></ion-icon>
      <p>Tap to add photo</p>
    </div>
  </div>
  <input type="file" accept="image/*" #fileInput (change)="onFileSelected($event)" style="display: none;" />

  <form (ngSubmit)="onSubmit()">

    <!-- Points/Money System Info -->
    <div class="sales-info-box ion-margin-bottom">
      <h3>ðŸ’Ž Sales Progress</h3>
      <p>{{ completedPointsSales }}/3 completed point-based sales</p>
      <ion-progress-bar [value]="Math.min(completedPointsSales / 3, 1)"></ion-progress-bar>
      <p class="help-text">
        <ion-icon name="information-circle-outline"></ion-icon>
        {{ canSellRealMoney ? 'âœ… You can now sell for real money!' : 'Complete ' + (3 - completedPointsSales) + ' more sale(s) to unlock real money selling.' }}
      </p>
    </div>

    <!-- Price Type Toggle -->
    <ion-item fill="outline" class="ion-margin-bottom">
      <ion-label>Price Type</ion-label>
      <ion-segment [(ngModel)]="product.isPoints" name="priceType">
        <ion-segment-button [value]="true">
          <ion-label>ðŸ’° Points</ion-label>
        </ion-segment-button>
        <ion-segment-button [value]="false" [disabled]="!canSellRealMoney">
          <ion-label>ðŸ’µ Real Money</ion-label>
        </ion-segment-button>
      </ion-segment>
    </ion-item>

    <ion-item fill="outline" class="ion-margin-bottom">
      <ion-label position="floating">{{ product.isPoints ? 'Points' : 'Price (â‚¹)' }}</ion-label>
      <ion-input type="number" [(ngModel)]="product.price" name="price" required></ion-input>
    </ion-item>

    <ion-item fill="outline" class="ion-margin-bottom">
      <ion-label position="floating">Title</ion-label>
      <ion-input [(ngModel)]="product.title" name="title" required></ion-input>
    </ion-item>

    <ion-item fill="outline" class="ion-margin-bottom">
      <ion-label position="floating">Description</ion-label>
      <ion-textarea rows="3" [(ngModel)]="product.description" name="desc" required></ion-textarea>
    </ion-item>

    <ion-item fill="outline" class="ion-margin-bottom">
      <ion-select label="Category" [(ngModel)]="product.categoryId" name="cat" (ionChange)="onCategoryChange()"
        required>
        <ion-select-option *ngFor="let c of categories" [value]="c.id">{{ c.name }}</ion-select-option>
      </ion-select>
    </ion-item>

    <ion-item fill="outline" class="ion-margin-bottom">
      <ion-select label="Sub Category" [(ngModel)]="product.subCategoryId" name="sub" [disabled]="!product.categoryId">
        <ion-select-option *ngFor="let s of subCategories" [value]="s.id">{{ s.name }}</ion-select-option>
      </ion-select>
    </ion-item>

    <ion-item fill="outline" class="ion-margin-bottom">
      <ion-select label="Condition" [(ngModel)]="product.condition" name="cond">
        <ion-select-option value="New">New</ion-select-option>
        <ion-select-option value="Like New">Like New</ion-select-option>
        <ion-select-option value="Good">Good</ion-select-option>
        <ion-select-option value="Fair">Fair</ion-select-option>
      </ion-select>
    </ion-item>

    <ion-item fill="outline" class="ion-margin-bottom">
      <ion-select label="Age Group" [(ngModel)]="product.ageGroupId" name="age" required>
        <ion-select-option *ngFor="let a of ageGroups" [value]="a.id">{{ a.name }}</ion-select-option>
      </ion-select>
    </ion-item>

    <ion-item fill="outline" class="ion-margin-bottom">
      <ion-select label="Ideal For" [(ngModel)]="product.genderId" name="gen" required>
        <ion-select-option *ngFor="let g of genders" [value]="g.id">{{ g.name }}</ion-select-option>
      </ion-select>
    </ion-item>

    <ion-item fill="outline" class="ion-margin-bottom">
      <ion-select label="Color" [(ngModel)]="product.colorId" name="col" required>
        <ion-select-option *ngFor="let c of colors" [value]="c.id">
          {{ c.name }}
        </ion-select-option>
      </ion-select>
    </ion-item>

    <ion-item fill="outline" class="ion-margin-bottom">
      <ion-select label="Material (Optional)" [(ngModel)]="product.materialId" name="mat">
        <ion-select-option *ngFor="let m of materials" [value]="m.id">{{ m.name }}</ion-select-option>
      </ion-select>
    </ion-item>

    <ion-button expand="block" type="submit" class="ion-margin-top" [disabled]="isSubmitting || !previewImage">
      {{ isSubmitting ? 'Publishing...' : 'List Item' }}
    </ion-button>

  </form>
</ion-content>